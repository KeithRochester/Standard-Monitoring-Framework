
# Windows Command Monitor
Used to monitor or collect the output from a Windows Command/Script. 

Can monitor:
	    
* StdOut as string and look for a regular expression match to indicate if the object is healthy or not.
* StdOut as number and confirm value is between minimum and maximum values.
* Return Code is the expected value.

Can also collect the number returned by StdOut as a performance counter for reporting and dashboards.

## Adding Monitoring

To add a Windows Command Monitor...

* Create/update **HKLM:\SOFTWARE\SMF\SCOMDiscoveryData\\##Business Service##\\##Environment##\\WindowsCommand** on the agent that will execute the command. [Example Registry Key](https://github.com/KeithRochester/Standard-Monitoring-Framework/blob/main/Documentation/Example%20Files/WindowsCommand.reg)
* Use the **SMF: Add Command Monitor** task.

## Run As Account
If the agents default action account doesn't have the required access to run the command a Windows run as account can be added to the **Standard Monitoring Framework Windows Command Monitoring Profile** run as profile.  

## Windows Command Properties 

|Property|Description|
|-|-|
|Command|The command that SCOM will execute|
|Working Directory|The working directory to be used when executing the command|
|Parameters|Parameters that will be passed to the command|
|Monitor Return Code|Controls if the return code from the monitored command should be monitored. True|False|
|Monitor StdOut Int Only|Controls if the StdOut from the monitored command should be compared as a numerical value. True|False|
|Collect StdOut IntOnly|Controls if the StdOut from the monitored command should be collected as a performance counter for reports/dashboards. StdOut must be a numerical value. True|False|
|Expected Return Code|Expected Return Code value. Only takes effect if Return Code is monitored|
|Expected Minimum StdOut Int Only|Minimum healthy value for StdOut. Only takes effect if StdOut is monitored as a numerical value|
|Expected Maximum StdOut Int Only|Maximum healthy value for StdOut. Only takes effect if StdOut is monitored as a numerical value|
|Monitor StdOut Formatted String|Controls if the StdOut from the monitored command should be compared as a string. e.g. looking for "Healthy" in the output. True|False|
|Expected StdOut Formatted String|Regular expression that must be matched for the monitor to be healthy. If there is not match the monitor will be unhealthy. Only takes effect if StdOut is monitored as string|

## General Properties

|Property|Description|
|-|-|
|Business Service|The name of the business service that the monitoring is part of|
|Environment|Which lifecycle environment does the business service belong to. E.g. Production, UAT, DEV, etc...|
|Business Service Team|Team that owns the business service|
|Component Name|Name of the logical group that the object belongs to. Used to group similar objects together. E.g. Backend server objects in a Backend Server Component Group|
|Frequency|Frequency in seconds that the monitoring will run|
|Match Count|The number of consecutive samples that must occur before the monitor is unhealthy|
|Schedule Start Time|Time of day that monitoring will run from e.g. 00:00, 08:00, etc...|
|Schedule End Time|Time of day that monitoring will stop running e.g. 23:59, 17:00, etc...|
|Schedule Days|Bit mask for the days of the week that monitoring should run<br>Sunday = 1<br>  Monday = 2 <br>Tuesday = 4<br>Wednesday = 8<br>Thursday = 16<br>Friday = 32<br>Saturday = 64<br><br>Sunday to Saturday = 127<br>Monday to Friday = 62.|
|Description|Description of the object being monitored. This text is included in the alert body|
|Severity|Severity or alerts and state on dashboards. Critical or Warning|
|Priority|Priority that alerts will be assigned. High, Medium, or Low|
|Documentation|Link to documentation. Will be referenced in alerts|
|Object Team|The name of the team that will be responsible for resolving alerts generated by the monitoring|
